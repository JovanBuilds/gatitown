---
import Layout from "../../layouts/Layout.astro";

if (Astro.locals.user) {
    return Astro.redirect("/admin");
}
---

<Layout title="Login Admin - GatiTown">
    <div
        class="min-h-screen bg-[#FFF4EA] flex items-center justify-center px-6"
    >
        <div class="bg-white p-8 rounded-3xl shadow-lg max-w-md w-full">
            <h1 class="text-3xl font-bold text-[#9A7B6A] mb-6 text-center">
                Admin Login
            </h1>

            <form id="login-form" class="space-y-6">
                <div>
                    <label
                        for="email"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Correo electrónico</label
                    >
                    <input
                        type="email"
                        id="email"
                        name="email"
                        required
                        class="w-full px-4 py-3 bg-[#FFF4EA] border-none rounded-xl focus:ring-2 focus:ring-[#A8D8E8] outline-none"
                    />
                </div>

                <div>
                    <label
                        for="password"
                        class="block text-sm font-medium text-gray-700 mb-2"
                        >Contraseña</label
                    >
                    <input
                        type="password"
                        id="password"
                        name="password"
                        required
                        class="w-full px-4 py-3 bg-[#FFF4EA] border-none rounded-xl focus:ring-2 focus:ring-[#A8D8E8] outline-none"
                    />
                </div>

                <p
                    id="error-message"
                    class="text-red-500 text-sm text-center hidden"
                >
                </p>

                <button
                    type="submit"
                    class="w-full bg-[#A8D8E8] hover:bg-[#F7C8B6] text-gray-900 font-semibold py-3 rounded-xl transition-colors"
                >
                    Iniciar Sesión
                </button>
            </form>
        </div>
    </div>
</Layout>

<script>
    const form = document.getElementById("login-form") as HTMLFormElement;
    const errorMessage = document.getElementById("error-message");

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorMessage?.classList.add("hidden");

        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        try {
            const response = await fetch("/api/auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                window.location.href = "/admin";
            } else {
                const result = await response.json();
                if (errorMessage) {
                    errorMessage.textContent =
                        result.error || "Error al iniciar sesión";
                    errorMessage.classList.remove("hidden");
                }
            }
        } catch (error) {
            if (errorMessage) {
                errorMessage.textContent = "Error de conexión";
                errorMessage.classList.remove("hidden");
            }
        }
    });
</script>
